var child_process=require("child_process"),colors=require("colors/safe"),colorList=["red","green","yellow","blue","magenta","cyan","gray"],nextColor=function(){var r=0;return function(){r>=colorList.length&&(r=0);var o=colorList[r];return r=(r+1)%colorList.length,o}}(),basename=function(r){var o=r.split("/");return o=o[o.length-1],o=o.split("\\"),o=o[o.length-1]},exec=function(r){if("string"==typeof r&&(r={command:r}),"string"!=typeof r.command)throw"Invalid command";var o=r.command,n=r.args||r.arguments||[],t=o.split(/\s+/);o=t[0],n=t.slice(1).concat(n);var e=r.tag||basename(o),s=function(){if(r.print)return function(o,n){r.print(o,n,e)};for(;e.length<20;)e+=" ";return e=(colors[r.color]||colors[nextColor()])(e),function(r,o){"stderr"===o?r=colors.red(r):"info"==o&&(r=colors.green(r)),console.log(e+" "+r)}}(),i={};for(var c in r)c in["command","args","tag","print"]||(i[c]=r[c]);var a=child_process.spawn(o,n,i),l="";a.stdout.on("data",function(r){l+=r.toString();for(var o,n;-1!=(o=l.indexOf("\n"));)n=l.substring(0,o),l=l.substring(o+1),s(n,"stdout")});var u="";return a.stderr.on("data",function(r){u+=r.toString();for(var o,n;-1!=(o=u.indexOf("\n"));)n=u.substring(0,o),u=u.substring(o+1),s(n,"stderr")}),a.on("close",function(r){s("* Process exit (code: "+r+")","info")}),a};exec.colorList=colorList,module.exports=exec;